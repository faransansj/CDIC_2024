# 2024 ICT 스마트 디바이스톤 
## 목차
    1. 개요
    2. 주요 기능
    3. 파일별 기능 설명
        1) parkick.py
        2) main.py
        3) alert.py
        4) web.py
    4. 설치 및 설정
    5. 사용 방법
    6. 향후 개선 사항
    7. 주의사항

## 개요
PARKICK 시스템은 IoT 기반 프로젝트로, 컴퓨터 비전과 GPIO 컴포넌트를 활용해 킥보드를 감지하고 주차 가능 여부를 분석하는 시스템입니다. 이 시스템은 여러 Python 스크립트로 구성되어 있으며, 이미지 캡처, 객체 감지, 경고 시스템, 웹 인터페이스를 통해 감지 결과를 모니터링하고 제어할 수 있습니다.

### 주요 기능
1) 킥보드 감지: YOLO 객체 감지 모델(kick200.pt, kickleft200.pt)을 사용해 카메라 이미지에서 킥보드를 인식합니다.
2) 주차 분석: 인도 또는 도로 환경을 분석하여 주차 가능 여부를 판단합니다.
3) GPIO 제어: 감지 결과에 따라 LED와 부저를 사용하여 물리적 경고를 제공합니다.
4) Flask 웹 인터페이스: 감지된 이미지를 웹 대시보드를 통해 확인하고, 킥보드 주차 및 대여 옵션을 관리할 수 있습니다.

---

## 파일별 기능 설명
1. parkick.py
의존성: OpenCV, Ultralytics YOLO, RPi.GPIO  
GPIO 핀 설정:  
button_pin: 15번 핀 (버튼 입력)  
led_pin: 17번 핀 (LED 출력)  
주요 함수:  
    button_callback: 버튼이 눌릴 때마다 LED를 켜거나 끕니다.
    capture_and_save: 지정된 웹캠 인덱스로부터 이미지를 캡처하고 파일로 저장합니다.
    analyze_environment: 이미지의 일부 영역을 분석하여 "인도" 또는 "도로"로 분류합니다.
    draw_boxes: 감지된 객체에 대해 경계 상자를 그려 시각적으로 표시합니다.
프로세스:  
네 개의 이미지를 순차적으로 캡처하고 킥보드를 감지한 뒤, 주변 환경을 분석하여 주차 가능 여부를 결정합니다.  

2. main.py  
의존성: OpenCV, Ultralytics YOLO, RPi.GPIO, alert.py  
GPIO 핀 설정:  
lock_pin, tilt_switch, boozer, led_Rsig, led_Gsig, led_Bsig, led_gnd  
주요 함수:  
capture_and_save: 웹캠에서 이미지를 캡처하여 파일로 저장합니다.  
프로세스:  
tilt_switch 상태를 모니터링하여 기울어짐이 감지되면 경고를 활성화합니다.  
킥보드 감지 및 주차 가능 여부를 확인하고, 경고 모듈을 호출해 LED 및 부저 알림을 제공합니다.  
  
3. alert.py  
목적: LED와 부저를 사용해 경고를 제공하는 라이브러리입니다.  
함수:  
    play_buzzer_parkO_pattern, play_buzzer_parkX_pattern: 주차 허용 또는 불가 시 다른 톤을 재생합니다.  
    play_buzzer_tilt_pattern: 기울어짐이 감지될 경우 부저 알림을 재생합니다.
    alert_park: 주차 상태에 따라 LED와 부저를 활성화합니다.
    alert_tilt: 기울기 스위치가 활성화되었을 때 경고 LED와 부저를 활성화합니다.
사용 방법: main.py에서 감지 상태에 따라 호출하여 물리적 알림을 제공합니다.  

4. web.py
목적: 감지 결과를 웹 대시보드로 시각화하고, 주차 및 대여를 제어할 수 있는 Flask 기반 웹 서버입니다.  
라우트:  
/: HTML 페이지를 통해 2x2 이미지 그리드와 각 이미지에 대한 캡션을 표시합니다.  
기능:  
감지된 이미지와 함께 "킥보드 주차하기" 및 "킥보드 대여하기" 버튼을 제공합니다.
간단하고 반응형 레이아웃으로 이미지 위치에 따른 설명 (right, left, frontUp, frontDown)을 제공하여 감지 결과를 직관적으로 전달합니다.  
사용 방법: 서버를 실행하여 PARKICK 상태를 원격으로 접근하고 제어할 수 있습니다.  
---
## 설치 및 설정

### 하드웨어 설정:
main.py와 alert.py에 설정된 GPIO 핀 구성을 참고하여 하드웨어 연결을 완료합니다.
이미지 캡처용으로 호환되는 카메라를 연결합니다.

아래는 main.py, alert.py에 기본으로 작성된 GPIO 핀 구성입니다.  
이를 참조하여 사용자 환경에 맞게 수정하여 사용하시면 됩니다.  
note) Raspberry pi GPIO BCM 기준으로 작성됨  

```python
lock_pin = 23

tilt_switch = 4

boozer = 14
led_Rsig = 15
led_Gsig = 17
led_Bsig = 27
led_gnd = 18
```

### 의존성 설치: 다음 명령어를 사용해 필요한 라이브러리를 설치합니다:

```bash
pip install opencv-python-headless flask RPi.GPIO ultralytics
```
프로그램 실행:

감지 및 분석 기능을 시작하려면:
```bash
python3 main.py
```
웹 인터페이스를 실행하려면:
```bash 
python3 web.py
```

사용 방법
이미지 캡처 및 감지:프로그램은 지정된 웹캠에서 이미지를 캡처하고 YOLO 모델을 적용하여 킥보드를 인식합니다. 분석 결과에 따라 주차 가능 여부를 출력하고 LED와 부저를 통해 시각 및 음성 경고를 제공합니다.
웹 인터페이스: http://<your-device-ip>:5000에서 웹 대시보드에 접속하여 감지 결과를 확인하고 킥보드 주차와 대여 옵션을 관리할 수 있습니다.
---

### 향후 개선 사항
- 추가 모델 통합: 다른 차량 유형이나 장애물을 인식하는 모델을 추가하여 감지 범위를 확장할 수 있습니다.
- 경고 강화: 환경 조건에 따라 더 세분화된 음성 및 시각 경고를 추가할 수 있습니다.
- UI 개선: 더 나은 사용자 경험을 위해 인터페이스를 인터랙티브하게 개발할 수 있습니다.
### 주의사항
GPIO 핀이 정확히 설정되었는지 확인하고, 보드의 전압이 연결된 장치와 호환되는지 반드시 확인하십시오.
여러 인스턴스를 동시에 실행하면 GPIO 핀과 카메라 리소스에 충돌이 발생할 수 있으므로 주의가 필요합니다.